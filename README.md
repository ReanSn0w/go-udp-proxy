# UDP Proxy Server

Простой и эффективный UDP прокси сервер, написанный на Go, который пересылает UDP пакеты между клиентами и целевым сервером.

## Особенности

- **Высокая производительность**: Асинхронная обработка соединений с использованием горутин
- **Управление соединениями**: Автоматическое создание и очистка неактивных соединений
- **Graceful shutdown**: Корректное завершение работы по сигналам SIGINT/SIGTERM
- **Настраиваемость**: Конфигурация через аргументы командной строки или переменные окружения
- **Логирование**: Подробное логирование всех операций
- **Таймауты**: Автоматическая очистка неактивных соединений через 5 минут

## Установка

```bash
go install github.com/ReanSn0w/go-udp-proxy/cmd/proxy@latest
```

## Использование

### Базовое использование

```bash
# Запуск прокси на порту 8080, пересылка на localhost:9090
./udp-proxy --host.port=8080 --proxy.host=127.0.0.1 --proxy.port=9090
```

### Использование переменных окружения

```bash
export HOST_PORT=8080
export PROXY_HOST=192.168.1.100
export PROXY_PORT=9090
./udp-proxy
```

### Параметры запуска

| Параметр | Env |Значение по умолчанию | Описание |
|--------------|----------|----------|------------------|
| `--debug` | DEBUG | `false` | Включить режим отладки |
| `--host.port` | HOST_PORT | `8080` | Порт для прослушивания входящих соединений |
| `--proxy.host` | PROXY_HOST | `127.0.0.1` | Хост целевого сервера |
| `--proxy.port` | PROXY_PORT | `9090` | Порт целевого сервера |
| `--options.buffer-size` | OPTIONS_BUFFER_SIZE | `65507` | Максимальный размер UDP пакета |
| `--options.read-deadline` | OPTIONS_READ_DEADLINE | `100` | Время ожидания ответа, мс |
| `--options.cleanup-interval` | OPTIONS_CLEANUP_INTERVAL | `30` | Интервал закрытия неактивных соединений, c |
| `--options.inactive-timeout` | OPTIONS_INACTIVE_TIMEOUT | `5` | Время по прошествии которого клиент считается неактивным, м |

## Архитектура

```
Клиент ──UDP──> UDP Proxy ──UDP──> Целевой сервер
   ↑                                      │
   └────────── UDP ──────────────────────┘
```

### Принцип работы

1. **Прослушивание**: Сервер прослушивает указанный порт для входящих UDP пакетов
2. **Маппинг соединений**: Для каждого уникального клиента создается отдельное соединение с целевым сервером
3. **Пересылка**: Пакеты пересылаются в обоих направлениях между клиентом и целевым сервером
4. **Управление состоянием**: Неактивные соединения автоматически закрываются через 5 минут
5. **Очистка**: Периодическая очистка неактивных соединений каждые 30 секунд

## Примеры

### Тестирование с эхо-сервером

1. Запустите тестовый эхо-сервер:
```bash
go run examples/echo_server.go 9090
```

2. В другом терминале запустите UDP прокси:
```bash
./udp-proxy --host.port=8080 --proxy.host=127.0.0.1 --proxy.port=9090
```

3. Протестируйте с помощью netcat:
```bash
echo "Hello, World!" | nc -u localhost 8080
```

### Пример с DNS прокси

```bash
# Пересылка DNS запросов на Google DNS
./udp-proxy --host.port=5353 --proxy.host=8.8.8.8 --proxy.port=53
```

### Пример с игровым сервером

```bash
# Пересылка на игровой сервер
./udp-proxy --host.port=25565 --proxy.host=game-server.example.com --proxy.port=25565
```

## Мониторинг и отладка

### Включение режима отладки

```bash
./udp-proxy --debug --host.port=8080 --proxy.host=127.0.0.1 --proxy.port=9090
```

В режиме отладки выводится подробная информация о:
- Входящих и исходящих пакетах
- Создании и закрытии соединений
- Ошибках и таймаутах
- Статистике пересылки данных

### Логи

Сервер логирует следующие события:
- Запуск и остановка сервера
- Создание новых клиентских соединений
- Пересылка пакетов (размер и направление)
- Очистка неактивных соединений
- Ошибки сети и обработки

## Разработка

### Структура проекта

```
go-udp-proxy/
├── .github/workflows
|   └── di.yaml              # Скрипт для сборки контейнера в Github Actions
├── cmd/
│   └── main.go              # Точка входа приложения
├── internal/
│   └── proxy/
│       └── server.go        # Основная логика UDP прокси
├── examples/
│   └── echo_server.go       # Тестовый эхо-сервер
|   Dockerfile               # Dockerfile для построения контейнера с утилитой
├── go.mod
├── go.sum
└── README.md
```

## Лицензия

MIT License

## Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой функции (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## Поддержка

Если у вас есть вопросы или проблемы, пожалуйста, создайте issue в GitHub репозитории.
